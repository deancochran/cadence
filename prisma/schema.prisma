generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model user {
  id                      String                       @id @unique
  username                String                       @unique
  email                   String                       @unique
  email_verified          Boolean                      @default(false)
  created_at              DateTime                     @default(now())
  stripe_id               String?                      @unique
  role                    UserRole?                    @default(BASE)
  bike_ftp                Int                          @default(150)
  run_ftp                 Int                          @default(10)
  swim_ftp                Int                          @default(5)
  unitType                UnitType                     @default(METRIC)
  activities              activities[]
  emailVerificationTokens emailVerificationToken[]
  keys                    key[]
  passwordResetTokens     passwordResetToken[]
  auth_sessions           session[]
  subscriptions           subscription?
  integration_logs        thirdPartyIntegrationLogs[]
  integrations            thirdPartyIntegrationToken[]

  @@index([id])
}

model subscription {
  user_id              String    @id @unique
  cancel_at            DateTime?
  cancel_at_period_end Boolean?
  canceled_at          DateTime?
  current_period_start DateTime
  current_period_end   DateTime
  created              DateTime
  ended_at             DateTime?
  start_date           DateTime
  trial_start          DateTime?
  trial_end            DateTime?
  metadata             Json
  status               String
  stripe_sub_id        String    @unique
  user                 user      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
}

model session {
  id             String @id @unique
  user_id        String
  active_expires BigInt
  idle_expires   BigInt
  user           user   @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model key {
  id              String  @id @unique
  hashed_password String?
  user_id         String
  user            user    @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model passwordResetToken {
  id      String  @id @unique
  expires BigInt?
  user_id String
  user    user    @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model emailVerificationToken {
  id      String  @id @unique
  expires BigInt?
  user_id String
  user    user    @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model thirdPartyIntegrationToken {
  id             Int                            @id @default(autoincrement())
  user_id        String
  provider       ThirdPartyIntegrationProvider?
  expires_at     BigInt
  expires_in     BigInt
  createdAt      DateTime                       @default(now())
  updatedAt      DateTime                       @updatedAt
  access_token   String
  refresh_token  String
  integration_id String                         @unique
  logs           thirdPartyIntegrationLogs[]
  user           user                           @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model thirdPartyIntegrationLogs {
  id          Int                            @id @default(autoincrement())
  provider    ThirdPartyIntegrationProvider?
  createdAt   DateTime                       @default(now())
  updatedAt   DateTime                       @updatedAt
  metadata    Json
  user_id     String
  token_id    Int
  token       thirdPartyIntegrationToken     @relation(fields: [token_id], references: [id], onDelete: Cascade)
  user        user                           @relation(fields: [user_id], references: [id], onDelete: Cascade)
  activity_id Int?                           @unique
  activity    activities?                    @relation(fields: [activity_id], references: [id], onDelete: Cascade)
}

model activities {
  id                       Int                        @id @unique @default(autoincrement())
  type                     ActivityType
  distance                 Float
  duration                 Int
  date                     DateTime                   @default(now())
  user_id                  String
  stress_score             Int
  user                     user                       @relation(fields: [user_id], references: [id], onDelete: Cascade)
  thirdPartyIntegrationLog thirdPartyIntegrationLogs?
}

enum ActivityType {
  CYCLING
  SWIMMING
  RUNNING
}

enum UserRole {
  PRO
  BASE
}

enum ThirdPartyIntegrationProvider {
  STRAVA
}

enum UnitType {
  IMPERIAL
  METRIC
}
